---
title: "Understory vegetation data handling"
author: "Luciano L.M. De Benedictis"
output: 
 pdf_document:
  latex_engine: xelatex
  keep_md: true
---


``` r
# setup -------------------------------------------------------------------

library(tidyverse)
```

```
## -- Attaching core tidyverse packages ------------------------ tidyverse 2.0.0 --
## v dplyr     1.1.4     v readr     2.1.6
## v forcats   1.0.1     v stringr   1.6.0
## v ggplot2   4.0.1     v tibble    3.3.0
## v lubridate 1.9.4     v tidyr     1.3.2
## v purrr     1.2.0     
## -- Conflicts ------------------------------------------ tidyverse_conflicts() --
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()
## i Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors
```

``` r
library(readxl)

# data import -------------------------------------------------------------

read_me <- list.files(path="data/transects", full.names = TRUE)
read_me <- read_me[order(as.numeric(gsub("[^0-9]+", "", read_me)))]

#lists of T
read_me2 <- read_me |> 
  basename() |> 
  tools::file_path_sans_ext()

#species names
specieslookup <- read_csv("data/specieslookup_harm.csv", show_col_types = F)


## transect data -----------------------------------------------------------

dat <- vector(mode = "list", length = length(read_me2))
for(i in seq_along(read_me2)){
  df <- read_csv(read_me[i], trim_ws = T, show_col_types = F) |> #header cut off already
    select(!2) |>
    rename(X=1) |> 
    mutate(across(where(is.character), toupper)) |>
    mutate(across(where(is.character), function(x) gsub("\\s+", "", x))) |>
    mutate(across(where(is.character), function(x) gsub("(PL)","", x, fixed = TRUE))) |> 
    pivot_longer(cols = !1, names_to = NULL, values_to = "code", values_drop_na = T) |> 
    filter(!code %in% c("MOSS", "TRUNK", "FERN", "D", "R","B", "ROOT", "")) |> 
    left_join(specieslookup, by = "code")
  dat[[i]] <- df
  names(dat)[i] <- read_me2[i]
}
rm(df, i, specieslookup)

#remove sites without structural and canopy data
dat[c("T15", "T16", "T17", "T32")] <- NULL

#check records without species names
NAs <- dat |> 
  lapply(function (x) filter(x, is.na(species))) |> 
  bind_rows() 

NAs |> 
  distinct(code) #all "sp."
```

```
## # A tibble: 4 x 1
##   code 
##   <chr>
## 1 HSP  
## 2 CASP 
## 3 TAR  
## 4 ROX
```

``` r
#remove those few genus-level records
dat <- dat |>  
  lapply(function (x) filter(x, !is.na(species)))

rm(NAs)

## species frequencies -----------------------------------------------------

#by plot
speciesfreqs_plot <- lapply(dat, function(x) count(x, code, species, family, sort = T)) |> 
  bind_rows(.id = "Plot")

#overall
speciesfreqs_all <- speciesfreqs_plot |>
  count(code, species, family, wt = n, sort = T) 

#clean dat
dat <- map(dat, ~select(.x, 1, 3))

# trait DB ----------------------------------------------------------------

##aboveground traits Diaz et al. 2022-----
gspff <- read_excel("data/GSPFF_enhanced/Species_mean_traits.xlsx", sheet = 1,
                    col_types = "text") |> 
  select(2, 16, 18, 20, 22, 24, 31) |> 
  rename(species=`Species name standardized against TPL`) |> 
  mutate(across(!species, as.numeric)) |> 
  mutate(presentgspff = T) |> 
  janitor::clean_names()

#synonyms
GSPFF_syno <- read_csv("data/synonyms_forGSPFF.txt", show_col_types = F) |> 
  filter(!is.na(`DB name`)) |> 
  rename(species = `DB name`)
GSPFF_syno <- setNames(GSPFF_syno$`Our name`, GSPFF_syno$species)

gspff <- gspff |>
  mutate(species = recode(species, !!!GSPFF_syno))
rm(GSPFF_syno)

##clonal from CLO-PLA---------
clopla <- read.csv("data/CLO-PLA-traits.txt", sep = "\t") |>
  mutate(Species_name = gsub("\"","", .data$Species_name)) |> 
  slice(-113) |> #allium urs. subsp., multiple match
  mutate(Species_name = word(.data$Species_name, 1, 2)) |>
  rename(species=Species_name) |> 
  mutate(presentclo = T) |> 
  select(species, presentclo, clonal, BBRsize, persistence, offspring, spread) |> 
  mutate(clonal = as.logical(clonal))

#synonyms
clopla_syno <- read_csv("data/synonyms_forCLOPLA.txt", show_col_types = F) |> 
  filter(!is.na(`DB name`)) |> 
  rename(species = `DB name`)
clopla_syno <- setNames(clopla_syno$`Our name`, clopla_syno$species)

clopla <- clopla |>
  mutate(species = recode(species, !!!clopla_syno))
rm(clopla_syno)

##join aboveground----
speciestraits <- left_join(speciesfreqs_all, gspff) |> 
  mutate(presentgspff = if_else(is.na(.data$presentgspff), F, T)) |> 
  relocate(presentgspff, .after=4)
```

```
## Joining with `by = join_by(species)`
```

``` r
#which species have height > 1.3 m?
tall <- speciestraits |> 
  filter(!plant_height_m < 1.3) |> 
  pull(species)

tall
```

```
##  [1] "Fagus sylvatica"     "Abies alba"          "Pteridium aquilinum"
##  [4] "Rubus hirtus"        "Acer pseudoplatanus" "Hedera helix"       
##  [7] "Cytisus scoparius"   "Fraxinus excelsior"  "Prunus avium"       
## [10] "Calystegia sepium"   "Acer platanoides"    "Sambucus nigra"     
## [13] "Euonymus latifolius" "Laburnum alpinum"    "Acer opalus"        
## [16] "Clematis vitalba"    "Crataegus monogyna"  "Sorbus aria"        
## [19] "Sorbus aucuparia"    "Quercus cerris"      "Tilia platyphyllos"
```

``` r
#how many records?
speciesfreqs_all |> 
  filter(species %in% tall) |> 
  print(n = 50)
```

```
## # A tibble: 21 x 4
##    code  species             family               n
##    <chr> <chr>               <chr>            <int>
##  1 FA    Fagus sylvatica     Fagaceae           650
##  2 AB    Abies alba          Pinaceae           195
##  3 PT    Pteridium aquilinum Dennstaedtiaceae   122
##  4 RU    Rubus hirtus        Rosaceae            74
##  5 PSE   Acer pseudoplatanus Sapindaceae         72
##  6 HEX   Hedera helix        Araliaceae          67
##  7 CY    Cytisus scoparius   Fabaceae            34
##  8 FRAX  Fraxinus excelsior  Oleaceae            30
##  9 AVI   Prunus avium        Rosaceae            16
## 10 COS   Calystegia sepium   Convolvulaceae      11
## 11 PLA   Acer platanoides    Sapindaceae          9
## 12 SAM   Sambucus nigra      Viburnaceae          9
## 13 ELA   Euonymus latifolius Celastraceae         6
## 14 LAB   Laburnum alpinum    Fabaceae             5
## 15 ACE   Acer opalus         Sapindaceae          4
## 16 CLE   Clematis vitalba    Ranunculaceae        3
## 17 CRA   Crataegus monogyna  Rosaceae             3
## 18 SOR   Sorbus aria         Rosaceae             2
## 19 AUC   Sorbus aucuparia    Rosaceae             1
## 20 QU    Quercus cerris      Fagaceae             1
## 21 TIG   Tilia platyphyllos  Malvaceae            1
```

``` r
rm(tall)

#remove seedlings/juveniles (above 1.3 m)
speciestraits <- speciestraits |> 
  filter(plant_height_m < 1.3 | is.na(plant_height_m))

##join clonal----
speciestraits <- left_join(speciestraits, clopla) |> 
  mutate(presentclo = if_else(is.na(.data$presentclo), F, T)) |> 
  relocate(presentclo, clonal, .after=5)
```

```
## Joining with `by = join_by(species)`
```

``` r
##join measured LS----
#Viola reichenbachiana and Euphorbia amygdaloides have measured LS

measured <- read_csv('data/measured_LS.csv') |> 
  select(2,3) |> 
  rename(LS = 2) |> 
  group_by(Species) |> 
  summarise(LS = mean(LS))
```

```
## New names:
## Rows: 5 Columns: 13
## -- Column specification
## -------------------------------------------------------- Delimiter: "," chr
## (1): Species dbl (12): Transect, Spacers length (cm) average, ...4, ...5, ...6,
## ...7, ......
## i Use `spec()` to retrieve the full column specification for this data. i
## Specify the column types or set `show_col_types = FALSE` to quiet this message.
## * `` -> `...4`
## * `` -> `...5`
## * `` -> `...6`
## * `` -> `...7`
## * `` -> `...8`
## * `` -> `...9`
## * `` -> `...10`
## * `` -> `...11`
## * `` -> `...12`
## * `` -> `...13`
```

``` r
speciestraits <- speciestraits |> 
  left_join(measured, by = join_by(species == Species)) |> 
  mutate(spread = if_else(!is.na(spread), spread, LS)) |> 
  select(!LS)

#two measured species that are actually clonal

speciestraits[speciestraits$species %in% measured$Species, "clonal"] <- T

rm(gspff,clopla, speciesfreqs_plot, speciesfreqs_all, measured)

##set species known as clonal if missing----

clonals <- c("Geranium nodosum", "Arisarum proboscideum", "Clinopodium nepeta")
speciestraits[speciestraits$species %in% clonals, "clonal"] <- T
rm(clonals)

##and species known as not clonal----

speciestraits <- speciestraits |> 
  mutate(clonal = if_else(is.na(clonal), F, clonal))

##set clonal traits at 0 if not clonal----

speciestraits <- speciestraits |> 
  mutate(across(persistence:spread, ~if_else(condition = !clonal & is.na(.x), true = 0, false = .x)))

# missingness -------------------------------------------------------------

# incomplete cases

sum(!complete.cases(speciestraits)) #26/83 overall
```

```
## [1] 26
```

``` r
sum(!complete.cases(speciestraits[8:13])) #22 for gspff
```

```
## [1] 22
```

``` r
sum(!complete.cases(speciestraits[14:17])) #9 for clo-pla
```

```
## [1] 9
```

``` r
# missing species gspff
speciestraits |> 
  filter(presentgspff==F) |> 
  pull(species)
```

```
## [1] "Cardamine chelidonia"  "Arisarum proboscideum"
```

``` r
# missing species clo-pla
speciestraits|> 
  filter(presentclo==F) |> 
  pull(species)
```

```
## [1] "Geranium nodosum"      "Daphne laureola"       "Cardamine chelidonia" 
## [4] "Rosa arvensis"         "Arisarum proboscideum" "Hypericum androsaemum"
## [7] "Clinopodium nepeta"
```

``` r
## empty cells for present species----

#gspff
speciestraits |> 
  filter(if_any(8:13, ~is.na(.) & presentgspff == T)) |> 
  select(leaf_area_mm2:ssd_combined_mg_mm3) |> 
  print(n =50)
```

```
## # A tibble: 20 x 6
##    leaf_area_mm2 nmass_mg_g lma_g_m2 plant_height_m diaspore_mass_mg
##            <dbl>      <dbl>    <dbl>          <dbl>            <dbl>
##  1         4067.       NA       26.0          0.307        0.4      
##  2        27262        NA       89.2          0.264       11.6      
##  3         1518.       24.6    108.           0.793       49.0      
##  4          110        NA       22.3          0.176        0.78     
##  5        24165.       NA       74.0          0.811        0.0000194
##  6           NA        NA       NA            0.206        1.64     
##  7           NA        NA       NA            0.179       NA        
##  8           NA        22.2     34.6          0.687        0.0000368
##  9          239        NA       29.6          0.394        0.256    
## 10           NA        21.1     51.9          0.799        0.0000194
## 11          302.       24.3     45.4          1.16        10.8      
## 12         3647        NA       42.6          0.404        0.146    
## 13         2121.       NA       36.9          0.393        0.121    
## 14           NA        19.7     31.0          0.160        1.39     
## 15         2198.       23.3     45.6          0.940        1.77     
## 16           NA        NA       NA            0.354       NA        
## 17           NA        NA       NA            0.182        4.49     
## 18          675        NA       NA            0.654        0.07     
## 19        12698.       NA       76.0          0.296        0.000022 
## 20           NA        NA       NA            0.828       NA        
## # i 1 more variable: ssd_combined_mg_mm3 <dbl>
```

``` r
#clonals
#these are the two species with measured LS and the three species added as clonal
speciestraits |> 
  filter(if_any(14:17, ~is.na(.)) & clonal == T) |> 
  select(species, presentclo, clonal, BBRsize:spread)
```

```
## # A tibble: 5 x 7
##   species                presentclo clonal BBRsize persistence offspring spread
##   <chr>                  <lgl>      <lgl>    <dbl>       <dbl>     <dbl>  <dbl>
## 1 Viola reichenbachiana  TRUE       TRUE      40            NA        NA   1.16
## 2 Geranium nodosum       FALSE      TRUE      NA            NA        NA  NA   
## 3 Euphorbia amygdaloides TRUE       TRUE      31.8          NA        NA   1.08
## 4 Arisarum proboscideum  FALSE      TRUE      NA            NA        NA  NA   
## 5 Clinopodium nepeta     FALSE      TRUE      NA            NA        NA  NA
```

``` r
#overall
speciestraits |> 
  group_by(presentgspff, presentclo) |> 
  summarise(across(where(is.numeric) & !n, ~ sum(is.na(.)))) |> 
  glimpse()
```

```
## `summarise()` has grouped output by 'presentgspff'. You can override using the
## `.groups` argument.
```

```
## Rows: 3
## Columns: 12
## Groups: presentgspff [2]
## $ presentgspff        <lgl> FALSE, TRUE, TRUE
## $ presentclo          <lgl> FALSE, FALSE, TRUE
## $ leaf_area_mm2       <int> 2, 0, 8
## $ nmass_mg_g          <int> 2, 1, 13
## $ lma_g_m2            <int> 2, 1, 5
## $ plant_height_m      <int> 2, 0, 0
## $ diaspore_mass_mg    <int> 2, 0, 3
## $ ssd_combined_mg_mm3 <int> 2, 3, 10
## $ BBRsize             <int> 2, 5, 0
## $ persistence         <int> 1, 2, 2
## $ offspring           <int> 1, 2, 2
## $ spread              <int> 1, 2, 0
```

``` r
## percent completeness----

onlytraits <- speciestraits |> 
  select(where(is.numeric)&!n)

#overall
100-sum(is.na(onlytraits))/prod(dim(onlytraits))*100
```

```
## [1] 90.84337
```

``` r
#gspff
100-sum(is.na(onlytraits[1:6]))/prod(dim(onlytraits[1:6]))*100
```

```
## [1] 88.75502
```

``` r
#clo-pla
100-sum(is.na(onlytraits[7:10]))/prod(dim(onlytraits[7:10]))*100
```

```
## [1] 93.9759
```

``` r
#by trait
onlytraits |> 
  summarise(across(everything(), ~ 100-sum(is.na(.x))/n()*100)) |> 
  glimpse()
```

```
## Rows: 1
## Columns: 10
## $ leaf_area_mm2       <dbl> 87.95181
## $ nmass_mg_g          <dbl> 80.72289
## $ lma_g_m2            <dbl> 90.36145
## $ plant_height_m      <dbl> 97.59036
## $ diaspore_mass_mg    <dbl> 93.9759
## $ ssd_combined_mg_mm3 <dbl> 81.92771
## $ BBRsize             <dbl> 91.56627
## $ persistence         <dbl> 93.9759
## $ offspring           <dbl> 93.9759
## $ spread              <dbl> 96.38554
```

``` r
# imputation --------------------------------------------------------------
#devtools::install_github("jinyizju/V.PhyloMaker2")
library(V.PhyloMaker2)
```

```
## Loading required package: ape
## 
## Attaching package: 'ape'
## 
## The following object is masked from 'package:dplyr':
## 
##     where
```

``` r
library(funspace)

## make phylogenetic tree----

for_phylo <- speciestraits |> 
  select(species, family) |> 
  mutate(genus = word(species), .after = 1)
for_phylo[for_phylo$genus == "Adoxa", "family"] <- "Adoxaceae"  #old family used by phylo

tree <- phylo.maker(for_phylo)
```

```
## Warning: Setting row names on a tibble is deprecated.
## Setting row names on a tibble is deprecated.
```

``` r
table(tree$species.list$status) #13 bind, 70 prune
```

```
## 
##  bind prune 
##    13    70
```

``` r
#check the phylogenetic tree
plot(tree$scenario.3, type = "phylogram", cex = 0.7)
```

![](2.data_setup_files/figure-latex/unnamed-chunk-1-1.pdf)<!-- --> 

``` r
rm(for_phylo)

#add status to traits
speciestraits <- tree$species.list |> 
  select(species, status) |> 
  right_join(speciestraits) |> 
  relocate(status, .after = presentclo)
```

```
## Joining with `by = join_by(species)`
```

``` r
## imputation --------------------------------------------------------------

#save traits before imputation

saveRDS(speciestraits, file = 'traits_noimp.rds')

#dataframe for imputation
imputation <- speciestraits |> 
  mutate(species = str_replace_all(species, " ", "_")) |> 
  select(!2:7) |> 
  mutate(clonal = as.factor(clonal)) |> 
  column_to_rownames(var = "species")

#impute missing traits
imputed <- impute(as.data.frame(imputation), phylo = tree$scenario.3)

imputed <- imputed$imputed |> 
  rownames_to_column("species") |> 
  mutate(species = str_replace_all(species, "_", " "))

#check imputed values

if (sum(!complete.cases(imputed)) != 0){
warning("There are still missing values after imputation!")
}


#add imputed values

speciestraits <- speciestraits |> 
  select(species:status) |> 
  left_join(imputed)
```

```
## Joining with `by = join_by(species)`
```

``` r
speciestraits |> 
  select(!5:8) |> 
  print(n = 100)
```

```
## # A tibble: 83 x 14
##    species   code  family     n leaf_area_mm2 nmass_mg_g lma_g_m2 plant_height_m
##    <chr>     <chr> <chr>  <int>         <dbl>      <dbl>    <dbl>          <dbl>
##  1 Sanicula~ SAN   Apiac~  1855        2700.        21.9     28.1         0.298 
##  2 Galium o~ G     Rubia~  1796         192.        24.2     24.3         0.267 
##  3 Melica u~ MEL   Poace~   680         454.        19.6     28.6         0.362 
##  4 Oxalis a~ O     Oxali~   622         146.        27.0     16.2         0.0910
##  5 Viola re~ VR    Viola~   612         488.        23.4     33.3         0.136 
##  6 Brachypo~ BRA   Poace~   490        2195.        21.6     23.1         0.662 
##  7 Luzula n~ NIV   Junca~   481         589.        24.9     40.2         0.616 
##  8 Festuca ~ FE    Poace~   480         285.        28.0     33.0         0.566 
##  9 Mercuria~ ME    Eupho~   418        1890.        32.3     38.3         0.273 
## 10 Hieraciu~ H     Aster~   357        4067.        29.5     26.0         0.307 
## 11 Veronica~ VE    Plant~   288         458         20.0     30.3         0.268 
## 12 Geranium~ NOD   Geran~   266        7445.        19.6     23.5         0.226 
## 13 Cardamin~ BUL   Brass~   263        2207.        36.1     24.8         0.425 
## 14 Carex sy~ CAR   Cyper~   250         677         21.8     38.3         0.451 
## 15 Geranium~ ROB   Geran~   250        1069.        25.8     30.5         0.276 
## 16 Milium e~ MIL   Poace~   231        1621.        23.1     29.2         0.843 
## 17 Hellebor~ HEL   Ranun~   201       27262         24.0     89.2         0.264 
## 18 Daphne l~ DA    Thyme~   192        1518.        24.6    108.          0.793 
## 19 Stellari~ STE   Caryo~   129         263.        33.6     20.6         0.152 
## 20 Euphorbi~ EU    Eupho~   124         313.        28.1     41.6         0.406 
## 21 Galium r~ ROT   Rubia~   121         110         27.0     22.3         0.176 
## 22 Lactuca ~ MY    Aster~   112        2002.        25.3     16.0         0.508 
## 23 Cardamin~ CHE   Brass~   103        1793.        32.3     33.8         0.440 
## 24 Circaea ~ CIR   Onagr~    90        2313.        23.7     22.2         0.335 
## 25 Alliaria~ AL    Brass~    85        2958.        42.4     23.2         0.438 
## 26 Senecio ~ S     Aster~    80        7780.        29.9     36.1         0.985 
## 27 Avenella~ AVE   Poace~    69          50.8       18.4     38.4         0.301 
## 28 Moehring~ STEX  Caryo~    66          77.4       26.6     28.1         0.154 
## 29 Luzula f~ LU    Junca~    59         339.        20.3     46.4         0.176 
## 30 Salvia g~ GLU   Lamia~    57       11483.        39.2     18.6         0.544 
## 31 Polystic~ POLY  Dryop~    54       24165.        24.0     74.0         0.811 
## 32 Anemonoi~ ANE   Ranun~    53        2924.        29.4     35.5         0.183 
## 33 Cardamin~ TRI   Brass~    52        1437.        28.1     33.9         0.206 
## 34 Adenosty~ AUS   Aster~    48       18139.        26.2     49.6         0.512 
## 35 Aremonia~ A     Rosac~    43        1602.        26.4     33.9         0.179 
## 36 Dryopter~ DRY   Dryop~    43        6532.        22.2     34.6         0.687 
## 37 Cardamin~ CIMP  Brass~    41         239         30.3     29.6         0.394 
## 38 Galium a~ APA   Rubia~    39         159.        25.7     25.9         0.390 
## 39 Galeopsi~ GT    Lamia~    38         857.        30.8     31.7         0.366 
## 40 Polystic~ SET   Dryop~    37        9356.        21.1     51.9         0.799 
## 41 Epipacti~ EPI   Orchi~    31        1617.        34.3     33.3         0.505 
## 42 Rosa arv~ RO    Rosac~    30         302.        24.3     45.4         1.16  
## 43 Saxifrag~ SAX   Saxif~    30        1876.        17.9     52.3         0.263 
## 44 Prenanth~ PRE   Aster~    27        2945.        30       15.2         0.789 
## 45 Adoxa mo~ ADO   Vibur~    25        1808.        37.2     26.1         0.0847
## 46 Carex re~ CRE   Cyper~    22         302.        16.3     36.3         0.433 
## 47 Dactylis~ DAC   Poace~    22        1457.        21.0     44.3         0.691 
## 48 Digitali~ DIG   Plant~    22        3647         26.6     42.6         0.404 
## 49 Primula ~ P     Primu~    21        4278.        23.9     30.7         0.0973
## 50 Allium u~ URS   Amary~    21        6409.        36.9     27.6         0.306 
## 51 Polygona~ MUL   Aspar~    20        1607.        30       22.8         0.423 
## 52 Urtica d~ U     Urtic~    17        1553.        42.9     34.6         0.883 
## 53 Silene d~ SIL   Caryo~    14        3533         30.1     27.7         0.556 
## 54 Hepatica~ HEP   Ranun~    13        2885.        18.8     36.2         0.100 
## 55 Lathyrus~ LAT   Fabac~    13        1504.        38.6     24.5         0.270 
## 56 Viola od~ V     Viola~    13        1827.        17.1     39.1         0.0895
## 57 Epilobiu~ MONT  Onagr~    12        2121.        25.5     36.9         0.393 
## 58 Euphorbi~ EDU   Eupho~    10         420         41.0     30.1         0.310 
## 59 Festuca ~ FX    Poace~    10        2404.        22.7     35.6         0.790 
## 60 Ajuga re~ AJU   Lamia~     9        1817.        19.7     31.0         0.160 
## 61 Impatien~ IMP   Balsa~     9        1578.        39.8     22.2         0.585 
## 62 Solanum ~ SOL   Solan~     8        1408.        39.6     28.7         1.01  
## 63 Arisarum~ ARP   Arace~     7        4242.        31.5     34.9         0.439 
## 64 Rubus id~ IDE   Rosac~     7        2198.        23.3     45.6         0.940 
## 65 Aegopodi~ AEG   Apiac~     6        2762.        27.5     35.3         0.621 
## 66 Galium a~ GAR   Rubia~     5        2066.        29.3     26.8         0.354 
## 67 Isopyrum~ CORY  Ranun~     4        5700.        23.7     44.3         0.182 
## 68 Lamium a~ LAM   Lamia~     4        1886.        42.3     28.5         0.319 
## 69 Lilium m~ LIL   Lilia~     4        3363.        37.6     38.5         0.583 
## 70 Poa nemo~ POA   Poace~     4         527.        22.1     28.3         0.461 
## 71 Prunella~ PRU   Lamia~     4         473.        19.2     34.9         0.145 
## 72 Veronica~ VC    Plant~     4         300.        21.6     34.4         0.200 
## 73 Hypericu~ AND   Hyper~     3         675         26.7     36.4         0.654 
## 74 Clinopod~ CLI   Lamia~     3         108         26.6     39.7         0.312 
## 75 Scrophul~ SCRO  Scrop~     3        5821.        28.8     33.5         0.750 
## 76 Vicia cr~ VCR   Fabac~     3         714.        39.2     44.0         0.626 
## 77 Aspleniu~ PHY   Asple~     2       12698.        23.0     76.0         0.296 
## 78 Vicia se~ VIC   Fabac~     2          59.1       46       25.6         0.445 
## 79 Veronica~ VO    Plant~     2          87.3       18.3     39.3         0.126 
## 80 Carduus ~ CARD  Aster~     1        4304.        27.1     39.3         0.828 
## 81 Fragaria~ FRA   Rosac~     1        1112.        18.4     45.3         0.114 
## 82 Solidago~ SOV   Aster~     1         984.        28.3     43.4         0.508 
## 83 Viola al~ VA    Viola~     1         920.        17.3     44.7         0.0705
## # i 6 more variables: diaspore_mass_mg <dbl>, ssd_combined_mg_mm3 <dbl>,
## #   BBRsize <dbl>, persistence <dbl>, offspring <dbl>, spread <dbl>
```

``` r
rm(imputation, tree, imputed)


# save data ---------------------------------------------------------------

saveRDS(speciestraits, file = "traits_imputation.rds")
saveRDS(dat, file = "transect_data.rds")

# session info ------------------------------------------------------------

sessionInfo()
```

```
## R version 4.5.2 (2025-10-31)
## Platform: x86_64-redhat-linux-gnu
## Running under: Nobara Linux 43 (KDE Plasma Desktop Edition)
## 
## Matrix products: default
## BLAS/LAPACK: FlexiBLAS OPENBLAS-OPENMP;  LAPACK version 3.12.1
## 
## locale:
##  [1] LC_CTYPE=it_IT.UTF-8      LC_NUMERIC=C             
##  [3] LC_TIME=it_IT.utf8        LC_COLLATE=it_IT.UTF-8   
##  [5] LC_MONETARY=it_IT.utf8    LC_MESSAGES=it_IT.UTF-8  
##  [7] LC_PAPER=it_IT.utf8       LC_NAME=C                
##  [9] LC_ADDRESS=C              LC_TELEPHONE=C           
## [11] LC_MEASUREMENT=it_IT.utf8 LC_IDENTIFICATION=C      
## 
## time zone: Europe/Rome
## tzcode source: system (glibc)
## 
## attached base packages:
## [1] stats     graphics  grDevices datasets  utils     methods   base     
## 
## other attached packages:
##  [1] funspace_0.2.2      V.PhyloMaker2_0.1.0 ape_5.8-1          
##  [4] readxl_1.4.5        lubridate_1.9.4     forcats_1.0.1      
##  [7] stringr_1.6.0       dplyr_1.1.4         purrr_1.2.0        
## [10] readr_2.1.6         tidyr_1.3.2         tibble_3.3.0       
## [13] ggplot2_4.0.1       tidyverse_2.0.0    
## 
## loaded via a namespace (and not attached):
##  [1] Rdpack_2.6.4            mnormt_2.1.1            gridExtra_2.3          
##  [4] phangorn_2.12.1         permute_0.9-8           rlang_1.1.6            
##  [7] magrittr_2.0.4          ade4_1.7-23             snakecase_0.11.1       
## [10] compiler_4.5.2          mgcv_1.9-4              vctrs_0.6.5            
## [13] maps_3.4.3              combinat_0.0-8          quadprog_1.5-8         
## [16] pkgconfig_2.0.3         crayon_1.5.3            fastmap_1.2.0          
## [19] utf8_1.2.6              CoprManager_0.5.7       rmarkdown_2.30         
## [22] tzdb_0.5.0              pracma_2.4.6            itertools_0.1-3        
## [25] bit_4.6.0               xfun_0.55               randomForest_4.7-1.2   
## [28] clusterGeneration_1.3.8 parallel_4.5.2          cluster_2.1.8.1        
## [31] R6_2.6.1                stringi_1.8.7           RColorBrewer_1.1-3     
## [34] ranger_0.17.0           cellranger_1.1.0        numDeriv_2016.8-1.1    
## [37] Rcpp_1.1.0              iterators_1.0.14        knitr_1.50             
## [40] optimParallel_1.0-2     Matrix_1.7-4            splines_4.5.2          
## [43] igraph_2.2.1            timechange_0.3.0        tidyselect_1.2.1       
## [46] rstudioapi_0.17.1       yaml_2.3.12             viridis_0.6.5          
## [49] vegan_2.7-2             doParallel_1.0.17       codetools_0.2-20       
## [52] doRNG_1.8.6.2           lattice_0.22-7          ks_1.15.1              
## [55] withr_3.0.2             S7_0.2.1                coda_0.19-4.1          
## [58] evaluate_1.0.5          phytools_2.5-2          mclust_6.1.2           
## [61] pillar_1.11.1           rngtools_1.5.2          KernSmooth_2.23-26     
## [64] foreach_1.5.2           generics_0.1.4          vroom_1.6.7            
## [67] hms_1.1.4               scales_1.4.0            glue_1.8.0             
## [70] janitor_2.2.1           scatterplot3d_0.3-44    tools_4.5.2            
## [73] paran_1.5.4             mvtnorm_1.3-3           fastmatch_1.1-6        
## [76] grid_4.5.2              missForest_1.6.1        rbibutils_2.4          
## [79] nlme_3.1-168            cli_3.6.5               DEoptim_2.2-8          
## [82] expm_1.0-0              viridisLite_0.4.2       gtable_0.3.6           
## [85] digest_0.6.39           farver_2.1.2            htmltools_0.5.9        
## [88] lifecycle_1.0.4         bit64_4.6.0-1           MASS_7.3-65
```



---
date: '2026-01-07'

---
