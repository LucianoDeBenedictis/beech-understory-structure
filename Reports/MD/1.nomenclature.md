---
title: "Nomenclature harmonization"
author: "Luciano L.M. De Benedictis"
output: 
 pdf_document:
  latex_engine: xelatex
  keep_md: true
---


``` r
# setup -------------------------------------------------------------------

library(tidyverse)
```

```
## -- Attaching core tidyverse packages ------------------------ tidyverse 2.0.0 --
## v dplyr     1.1.4     v readr     2.1.6
## v forcats   1.0.1     v stringr   1.6.0
## v ggplot2   4.0.1     v tibble    3.3.0
## v lubridate 1.9.4     v tidyr     1.3.2
## v purrr     1.2.0     
## -- Conflicts ------------------------------------------ tidyverse_conflicts() --
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()
## i Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors
```

``` r
library(readxl)

# taxonomic harmonization -------------------------------------------------

#with TNRS
speciesharm <- read_csv("data/tnrs_result.csv") |> 
  select(c("Name_submitted", "Accepted_species", "Accepted_family"))
```

```
## Rows: 148 Columns: 48
## -- Column specification --------------------------------------------------------
## Delimiter: ","
## chr (25): Name_submitted, Name_matched, Name_matched_rank, Author_submitted,...
## dbl (10): Overall_score, Name_matched_id, Name_score, Author_score, Genus_sc...
## num  (2): ID, unique_id
## lgl (11): Family_submitted, Family_matched, Family_score, Infraspecific_rank...
## 
## i Use `spec()` to retrieve the full column specification for this data.
## i Specify the column types or set `show_col_types = FALSE` to quiet this message.
```

``` r
speciesharm[146,2] <- "Cyclamen repandum" #not accepted yet
speciesharm[146,3] <- "Primulaceae"
speciesharm[147,2] <- "Stellaria nemorum" #error because of subsp.

specieslist <- read_excel("data/Species_list.xlsx")
specieslist <- specieslist |> 
  left_join(speciesharm, by = join_by("Species name"=="Name_submitted")) |> 
  rename(species = "Accepted_species") |> 
  rename(code = Code) |>
  rename(family = "Accepted_family") |> 
  filter(!is.na(species)) |> 
  select(!"Species name")
```

Here is the output. The reference species list is larger than the list for the transect, so some species don't have a transect code.


``` r
print(specieslist, n = 150)
```

```
## # A tibble: 143 x 3
##     code  species                    family          
##     <chr> <chr>                      <chr>           
##   1 AB    Abies alba                 Pinaceae        
##   2 ACE   Acer opalus                Sapindaceae     
##   3 PLA   Acer platanoides           Sapindaceae     
##   4 PSE   Acer pseudoplatanus        Sapindaceae     
##   5 ACH   Achillea millefolium       Asteraceae      
##   6 <NA>  Aconitum lycoctonum        Ranunculaceae   
##   7 <NA>  Actaea spicata             Ranunculaceae   
##   8 AUS   Adenostyles australis      Asteraceae      
##   9 ADO   Adoxa moschatellina        Viburnaceae     
##  10 AEG   Aegopodium podagraria      Apiaceae        
##  11 AJU   Ajuga reptans              Lamiaceae       
##  12 AL    Alliaria petiolata         Brassicaceae    
##  13 URS   Allium ursinum             Amaryllidaceae  
##  14 ANE   Anemonoides nemorosa       Ranunculaceae   
##  15 A     Aremonia agrimonoides      Rosaceae        
##  16 ARP   Arisarum proboscideum      Araceae         
##  17 ARU   Arum maculatum             Araceae         
##  18 PHY   Asplenium scolopendrium    Aspleniaceae    
##  19 <NA>  Asplenium trichomanes      Aspleniaceae    
##  20 <NA>  Athyrium filix-femina      Aspleniaceae    
##  21 AVE   Avenella flexuosa          Poaceae         
##  22 BRA   Brachypodium sylvaticum    Poaceae         
##  23 CAM   Campanula trachelium       Campanulaceae   
##  24 <NA>  Cardamine amara            Brassicaceae    
##  25 BUL   Cardamine bulbifera        Brassicaceae    
##  26 CHE   Cardamine chelidonia       Brassicaceae    
##  27 HEPT  Cardamine heptaphylla      Brassicaceae    
##  28 CIMP  Cardamine impatiens        Brassicaceae    
##  29 TRI   Cardamine trifolia         Brassicaceae    
##  30 CARD  Carduus personata          Asteraceae      
##  31 <NA>  Carex divulsa              Cyperaceae      
##  32 CRE   Carex remota               Cyperaceae      
##  33 CAR   Carex sylvatica            Cyperaceae      
##  34 <NA>  Cephalanthera rubra        Orchidaceae     
##  35 <NA>  Chaerophyllum temulum      Apiaceae        
##  36 CIR   Circaea lutetiana          Onagraceae      
##  37 <NA>  Cirsium erisithales        Asteraceae      
##  38 CLE   Clematis vitalba           Ranunculaceae   
##  39 CLI   Clinopodium nepeta         Lamiaceae       
##  40 COS   Calystegia sepium          Convolvulaceae  
##  41 CRA   Crataegus monogyna         Rosaceae        
##  42 CRU   Cruciata glabra            Rubiaceae       
##  43 CYC   Cyclamen repandum          Primulaceae     
##  44 <NA>  Cystopteris fragilis       Cystopteridaceae
##  45 CY    Cytisus scoparius          Fabaceae        
##  46 DAC   Dactylis glomerata         Poaceae         
##  47 <NA>  Dactylorhiza incarnata     Orchidaceae     
##  48 DA    Daphne laureola            Thymelaeaceae   
##  49 DIG   Digitalis lutea            Plantaginaceae  
##  50 <NA>  Dioscorea communis         Dioscoreaceae   
##  51 FX    Festuca altissima          Poaceae         
##  52 DRY   Dryopteris filix-mas       Dryopteridaceae 
##  53 MONT  Epilobium montanum         Onagraceae      
##  54 EPI   Epipactis helleborine      Orchidaceae     
##  55 <NA>  Epipactis purpurata        Orchidaceae     
##  56 EQ    Equisetum ramosissimum     Equisetaceae    
##  57 ELA   Euonymus latifolius        Celastraceae    
##  58 EU    Euphorbia amygdaloides     Euphorbiaceae   
##  59 EDU   Euphorbia dulcis           Euphorbiaceae   
##  60 FA    Fagus sylvatica            Fagaceae        
##  61 FE    Festuca heterophylla       Poaceae         
##  62 FRA   Fragaria vesca             Rosaceae        
##  63 FRAX  Fraxinus excelsior         Oleaceae        
##  64 GT    Galeopsis tetrahit         Lamiaceae       
##  65 APA   Galium aparine             Rubiaceae       
##  66 GAR   Galium aristatum           Rubiaceae       
##  67 G     Galium odoratum            Rubiaceae       
##  68 ROT   Galium rotundifolium       Rubiaceae       
##  69 NOD   Geranium nodosum           Geraniaceae     
##  70 ROB   Geranium robertianum       Geraniaceae     
##  71 HEX   Hedera helix               Araliaceae      
##  72 HEL   Helleborus viridis         Ranunculaceae   
##  73 HEP   Hepatica nobilis           Ranunculaceae   
##  74 <NA>  Hesperis matronalis        Brassicaceae    
##  75 H     Hieracium murorum          Asteraceae      
##  76 AND   Hypericum androsaemum      Hypericaceae    
##  77 <NA>  Hypericum montanum         Hypericaceae    
##  78 <NA>  Hypericum perforatum       Hypericaceae    
##  79 <NA>  Ilex aquifolium            Aquifoliaceae   
##  80 IMP   Impatiens noli-tangere     Balsaminaceae   
##  81 ISO   Isopyrum thalictroides     Ranunculaceae   
##  82 CORY  Isopyrum thalictroides     Ranunculaceae   
##  83 LAB   Laburnum alpinum           Fabaceae        
##  84 LAM   Lamium album               Lamiaceae       
##  85 <NA>  Lapsana communis           Asteraceae      
##  86 LAT   Lathyrus vernus            Fabaceae        
##  87 LIL   Lilium martagon            Liliaceae       
##  88 LU    Luzula forsteri            Juncaceae       
##  89 NIV   Luzula nivea               Juncaceae       
##  90 MEL   Melica uniflora            Poaceae         
##  91 ME    Mercurialis perennis       Euphorbiaceae   
##  92 MIL   Milium effusum             Poaceae         
##  93 STEX  Moehringia trinervia       Caryophyllaceae 
##  94 <NA>  Monotropa hypopitys        Ericaceae       
##  95 MON   Monotropa hypopitys        Ericaceae       
##  96 MY    Lactuca muralis            Asteraceae      
##  97 <NA>  Myosotis decumbens         Boraginaceae    
##  98 <NA>  Neottia nidus-avis         Orchidaceae     
##  99 <NA>  Ostrya carpinifolia        Betulaceae      
## 100 O     Oxalis acetosella          Oxalidaceae     
## 101 <NA>  Parietaria officinalis     Urticaceae      
## 102 POA   Poa nemoralis              Poaceae         
## 103 MUL   Polygonatum multiflorum    Asparagaceae    
## 104 POLY  Polystichum aculeatum      Dryopteridaceae 
## 105 SET   Polystichum setiferum      Dryopteridaceae 
## 106 PRE   Prenanthes purpurea        Asteraceae      
## 107 P     Primula vulgaris           Primulaceae     
## 108 PRU   Prunella vulgaris          Lamiaceae       
## 109 AVI   Prunus avium               Rosaceae        
## 110 PT    Pteridium aquilinum        Dennstaedtiaceae
## 111 QU    Quercus cerris             Fagaceae        
## 112 RO    Rosa arvensis              Rosaceae        
## 113 RU    Rubus hirtus               Rosaceae        
## 114 IDE   Rubus idaeus               Rosaceae        
## 115 GLU   Salvia glutinosa           Lamiaceae       
## 116 SAM   Sambucus nigra             Viburnaceae     
## 117 SAN   Sanicula europaea          Apiaceae        
## 118 SAX   Saxifraga rotundifolia     Saxifragaceae   
## 119 SCRO  Scrophularia nodosa        Scrophulariaceae
## 120 SED   Sedum cepaea               Crassulaceae    
## 121 <NA>  Sedum monregalense         Crassulaceae    
## 122 S     Senecio ovatus             Asteraceae      
## 123 <NA>  Senecio squalidus          Asteraceae      
## 124 SIL   Silene dioica              Caryophyllaceae 
## 125 SOL   Solanum dulcamara          Solanaceae      
## 126 SOV   Solidago virgaurea         Asteraceae      
## 127 SOR   Sorbus aria                Rosaceae        
## 128 AUC   Sorbus aucuparia           Rosaceae        
## 129 STE   Stellaria media            Caryophyllaceae 
## 130 NEM   Stellaria nemorum          Caryophyllaceae 
## 131 <NA>  Thalictrum aquilegiifolium Ranunculaceae   
## 132 TIG   Tilia platyphyllos         Malvaceae       
## 133 <NA>  Trifolium repens           Fabaceae        
## 134 <NA>  Ulmus glabra               Ulmaceae        
## 135 U     Urtica dioica              Urticaceae      
## 136 VC    Veronica chamaedrys        Plantaginaceae  
## 137 VE    Veronica montana           Plantaginaceae  
## 138 VO    Veronica officinalis       Plantaginaceae  
## 139 VCR   Vicia cracca               Fabaceae        
## 140 VIC   Vicia sepium               Fabaceae        
## 141 VA    Viola alba                 Violaceae       
## 142 V     Viola odorata              Violaceae       
## 143 VR    Viola reichenbachiana      Violaceae
```

``` r
write_csv(specieslist, "data/specieslookup_harm.csv")


# session info ------------------------------------------------------------

sessionInfo()
```

```
## R version 4.5.2 (2025-10-31)
## Platform: x86_64-redhat-linux-gnu
## Running under: Nobara Linux 43 (KDE Plasma Desktop Edition)
## 
## Matrix products: default
## BLAS/LAPACK: FlexiBLAS OPENBLAS-OPENMP;  LAPACK version 3.12.1
## 
## locale:
##  [1] LC_CTYPE=it_IT.UTF-8      LC_NUMERIC=C             
##  [3] LC_TIME=it_IT.utf8        LC_COLLATE=it_IT.UTF-8   
##  [5] LC_MONETARY=it_IT.utf8    LC_MESSAGES=it_IT.UTF-8  
##  [7] LC_PAPER=it_IT.utf8       LC_NAME=C                
##  [9] LC_ADDRESS=C              LC_TELEPHONE=C           
## [11] LC_MEASUREMENT=it_IT.utf8 LC_IDENTIFICATION=C      
## 
## time zone: Europe/Rome
## tzcode source: system (glibc)
## 
## attached base packages:
## [1] stats     graphics  grDevices datasets  utils     methods   base     
## 
## other attached packages:
##  [1] readxl_1.4.5    lubridate_1.9.4 forcats_1.0.1   stringr_1.6.0  
##  [5] dplyr_1.1.4     purrr_1.2.0     readr_2.1.6     tidyr_1.3.2    
##  [9] tibble_3.3.0    ggplot2_4.0.1   tidyverse_2.0.0
## 
## loaded via a namespace (and not attached):
##  [1] bit_4.6.0          gtable_0.3.6       crayon_1.5.3       compiler_4.5.2    
##  [5] tidyselect_1.2.1   parallel_4.5.2     scales_1.4.0       yaml_2.3.12       
##  [9] fastmap_1.2.0      R6_2.6.1           generics_0.1.4     knitr_1.50        
## [13] pillar_1.11.1      RColorBrewer_1.1-3 tzdb_0.5.0         rlang_1.1.6       
## [17] utf8_1.2.6         stringi_1.8.7      xfun_0.55          S7_0.2.1          
## [21] bit64_4.6.0-1      timechange_0.3.0   cli_3.6.5          withr_3.0.2       
## [25] magrittr_2.0.4     digest_0.6.39      grid_4.5.2         vroom_1.6.7       
## [29] rstudioapi_0.17.1  CoprManager_0.5.7  hms_1.1.4          lifecycle_1.0.4   
## [33] vctrs_0.6.5        evaluate_1.0.5     glue_1.8.0         cellranger_1.1.0  
## [37] farver_2.1.2       rmarkdown_2.30     tools_4.5.2        pkgconfig_2.0.3   
## [41] htmltools_0.5.9
```



---
date: '2026-01-07'

---
